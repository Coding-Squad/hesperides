#!groovy

@Library(["rundeck@2.1.5"]) _

pipeline {
    agent { node { label 'default||master' } }
    stages {
        stage('Deploy docker') {
            steps {
                script {
                    Map optionsRundeck = [
                            composant             : "DOCKER-dockerregistry.socrate.vsct.fr/hesperides/hesperides:feature_springboot",
                            instances             : "HESA11DCK",
                            trigramme             : "HES",
                            techno                : "DOCKER",
                            TargetNodes           : "HESREL1DOCKERdockerregistry.socrate.vsct.fr/hesperides/hesperides:feature_springboot-CIAOBABY",
                            loglevel              : 3,
                            plateforme            : "REL1",
                            serveur               : "ciaobaby",


                    ]
                    deployId = devrundeck.startAndWaitWithAutofill("HES", "Instance_Management/Reboot_Instance", optionsRundeck)
                }
            }
        }
    }
    post {
        always {
            deleteDir()
        }
    }
}
